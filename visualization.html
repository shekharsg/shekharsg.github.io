
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Data Visualization | Shekhar Sharan Goyal</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <header>
    <h1>Interactive Visualizations</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="projects.html">Projects</a>
      <a href="publications.html">Publications</a>
      <a href="contact.html">Contact</a>
      <a href="visualization.html">Visualization</a>
    </nav>
  </header>
<main style="padding: 2rem;">
  <h2>Explore Nitrogen Metrics by District</h2>
  <label for="datasetSelect"><strong>Dataset:</strong></label>
  <select id="datasetSelect">
    <option value="uncertainty">N-Surplus + Uncertainty</option>
    <option value="components">N Components Breakdown</option>
  </select>

  <label for="districtSelect"><strong>District:</strong></label>
  <select id="districtSelect"></select>

  <label for="variableSelect"><strong>Variables:</strong></label>
  <select id="variableSelect" multiple size="5" style="width:300px;"></select>

  <div id="plot" style="width:100%;height:600px;margin-top:2rem;"></div>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    const files = {
      uncertainty: 'nutrient_budjet_uncertainity_12_values_nca.csv',
      components: 'N_surplus_components.csv'
    };

    let datasets = {};
    let current = 'uncertainty';

    // Load both datasets first
    Promise.all(Object.entries(files).map(([key, url]) =>
      fetch(url).then(r => r.text()).then(txt => {
        datasets[key] = Papa.parse(txt, { header: true, skipEmptyLines: true }).data;
      })
    )).then(initializeUI);

    function initializeUI() {
      const datasetSelect = document.getElementById("datasetSelect");
      datasetSelect.addEventListener("change", () => {
        current = datasetSelect.value;
        populateDistricts();
      });
      populateDistricts();
    }

    function populateDistricts() {
      const data = datasets[current];
      const districts = [...new Set(data.map(d => d["Dist Name"]))].sort();
      const districtSelect = document.getElementById("districtSelect");
      districtSelect.innerHTML = "";
      districts.forEach(d => {
        const option = document.createElement("option");
        option.value = d;
        option.textContent = d;
        districtSelect.appendChild(option);
      });
      districtSelect.onchange = () => populateVariables(districtSelect.value);
      populateVariables(districts[0]);
    }

    function populateVariables(district) {
      const data = datasets[current];
      const filtered = data.filter(d => d["Dist Name"] === district);
      const variableSelect = document.getElementById("variableSelect");
      variableSelect.innerHTML = "";

      const sample = filtered[0];
      const ignore = ["State Name", "Dist Name", "Year"];
      const keys = Object.keys(sample).filter(k => !ignore.includes(k));

      keys.forEach(k => {
        const option = document.createElement("option");
        option.value = k;
        option.textContent = k;
        variableSelect.appendChild(option);
      });

      variableSelect.onchange = () => renderPlot(district, Array.from(variableSelect.selectedOptions).map(o => o.value));
      renderPlot(district, [keys[0]]);
    }

    function renderPlot(district, variables) {
      const data = datasets[current];
      const filtered = data.filter(d => d["Dist Name"] === district);
      const years = filtered.map(d => +d["Year"]);

      const traces = variables.map(v => ({
        x: years,
        y: filtered.map(d => +d[v]),
        name: v.replace(/_/g, ' '),
        mode: 'lines+markers',
        type: 'scatter'
      }));

      const layout = {
        title: `Nutrient Data for ${district}`,
        xaxis: { title: "Year" },
        yaxis: { title: "kg/ha" },
        legend: { orientation: "h" }
      };

      Plotly.newPlot("plot", traces, layout);
    }
  </script>
</main>


  <footer><p>&copy; 2025 Shekhar Sharan Goyal</p></footer>
</body>
</html>
