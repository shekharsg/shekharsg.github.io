<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Publications | Dynamic ORCID Fetch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; 
      padding: 0;
      background: #f8f9fa;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    main {
      max-width: 800px;
      margin: 1rem auto;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
    }
    h1 {
      margin: 0;
    }
    #orcidPublications {
      list-style: none;
      padding-left: 0;
    }
    #orcidPublications li {
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.5rem;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>My ORCID Publications</h1>
  </header>
  <main>
    <p>
      Below is a dynamically fetched list of my publications from my 
      <a href="https://orcid.org/0009-0000-6979-3975" target="_blank">ORCID profile</a>.
    </p>
    <ul id="orcidPublications">
      <li>Loading publications from ORCID...</li>
    </ul>
    <div id="errorMessage" class="error"></div>
  </main>

  <script>
    // The public ORCID iD for Shekhar Sharan Goyal
    const orcidID = '0009-0000-6979-3975';
    // We'll try the v3.0 public endpoint for works
    const orcidWorksURL = `https://pub.orcid.org/v3.0/${orcidID}/works`;

    // Make sure we set the Accept header to JSON
    fetch(orcidWorksURL, {
      headers: {
        'Accept': 'application/json'
      }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log('ORCID data:', data);
      displayPublications(data);
    })
    .catch(err => {
      console.error('Error fetching ORCID data:', err);
      document.getElementById('errorMessage').textContent = 
        'Could not fetch data from ORCID. ' + err;
      document.getElementById('orcidPublications').innerHTML = '';
    });

    function displayPublications(jsonData) {
      // The data structure can be quite nested depending on ORCID’s version
      // Typically, the array of “works” is in jsonData.group or jsonData["work-group"]

      const pubContainer = document.getElementById('orcidPublications');
      pubContainer.innerHTML = ''; // clear "Loading..."

      // ORCID data structure can be: data['group'] or data['activities-summary']['works']['group']
      // Let's find the correct path by investigating the console log (the structure sometimes changes)
      // We'll try the typical path for v3.0:
      let workGroups = [];
      if (jsonData['group']) {
        // ORCID v3.x summary
        workGroups = jsonData['group'];
      } else if (jsonData['activities-summary'] 
                 && jsonData['activities-summary']['works']
                 && jsonData['activities-summary']['works']['group']) {
        workGroups = jsonData['activities-summary']['works']['group'];
      } else {
        // If no recognized path
        pubContainer.innerHTML = '<li>No works found in ORCID data</li>';
        return;
      }

      // For each group, we usually have an array of “work-summary”
      let count = 0;
      workGroups.forEach(g => {
        const workSummaries = g['work-summary'] || [];
        workSummaries.forEach(work => {
          count++;
          // Title is typically: work['title']['title']['value']
          const title = work.title && work.title.title 
                        ? work.title.title.value 
                        : 'Untitled work';

          // We might have a URL or external ID. It's not guaranteed.
          // Usually can find a put-code to fetch more details if we want
          const putCode = work['put-code'];

          // Create a list item
          const li = document.createElement('li');
          li.textContent = `${count}. ${title}`;
          pubContainer.appendChild(li);
        });
      });

      if (count === 0) {
        pubContainer.innerHTML = '<li>No publications found in your ORCID data.</li>';
      }
    }
  </script>
</body>
</html>
